<div class="container my-4">

  <div class="mb-3">
    <input type="search" placeholder="Search by username"
      [(ngModel)]="searchText" (input)="onSearchChange()"
      class="form-control form-control-lg"
      aria-label="Search users by username" />
  </div>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle mb-0" style="cursor: pointer;">
      <thead class="table-dark">
        <tr>
          <th scope="col" title="Unique User Identifier">UserId</th>
          <th scope="col" title="User's Username">UserName</th>
          <th scope="col" title="Email Address">Email</th>
          <th scope="col" title="Type of Customer">CustomerType</th>
          <th scope="col" title="Date of Last Login">Last Login</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of pageOfUsers"
            (click)="selectUser(user)"
            [class.table-primary]="selectedUser?.userId === user.userId"
            [attr.aria-selected]="selectedUser?.userId === user.userId">
          <td>{{user.userId}}</td>
          <td>{{user.userName}}   
     <img *ngIf="user.isVerified"
        src="assets/icons/verified-protection-svgrepo-com.svg"
       alt="Verified Icon"
       title="Verified User"
       aria-label="Verified User Icon"
       style="width: 18px; height: 18px; margin-left: 6px; vertical-align: text-bottom;" />
        </td>
          <td>{{user.email}}</td>
          <td>{{user.customerType}}</td>
          <td>{{user.lastLoginAt | date:'medium'}}</td>
        </tr>
        <tr *ngIf="pageOfUsers.length === 0">
          <td colspan="5" class="text-center text-muted fst-italic py-4">
            No users found.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <nav aria-label="User pagination" class="mt-3 d-flex justify-content-between align-items-center">

    <div>
      <button class="btn btn-outline-primary me-2" 
              [disabled]="currentPage === 1" 
              (click)="onPageChange(currentPage - 1)" 
              aria-label="Previous page">
        &laquo; Previous
      </button>
      <button class="btn btn-outline-primary" 
              [disabled]="currentPage === totalPages()" 
              (click)="onPageChange(currentPage + 1)" 
              aria-label="Next page">
        Next &raquo;
      </button>
    </div>

    <div>
      <small class="text-muted">
        Page {{currentPage}} of {{totalPages()}} | {{filteredUsers.length}} user(s) total
      </small>
    </div>

  </nav>

  <div *ngIf="selectedUser" class="mt-5 p-4 border rounded shadow-sm bg-light">
    <h4 class="mb-3">
      Accounts for: <span class="text-primary">{{selectedUser.userName}}</span>
    </h4>

    <div class="table-responsive">
      <table class="table table-bordered align-middle" aria-describedby="accountsInfo">
        <thead class="table-secondary">
          <tr>
            <th scope="col" title="Unique Account Number">Account Number</th>
            <th scope="col" title="Last Transaction Date">Last Transaction</th>
            <th scope="col" title="Current Balance">Balance</th>
            <th scope="col" title="Type of Account">Account Type</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let account of selectedUser.accountsList">
            <td>{{account.accountNumber}}</td>
            <td>{{account.lastTransactionAt | date:'medium'}}</td>
            <td>{{account.balance | currency:'INR':'symbol'}}</td>
            <td>{{account.accountTypeName}}</td>
          </tr>
          <tr *ngIf="selectedUser.accountsList.length === 0">
            <td colspan="4" class="text-center fst-italic text-muted py-3">
              No accounts found for this user.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <button type="button" class="btn btn-outline-secondary mt-3" (click)="clearSelection()">
      &larr; Back to User List
    </button>
  </div>

</div>
